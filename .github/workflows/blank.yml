---
name: check-all

on:
  push:
  pull_request:
  workflow_dispatch:

jobs:
  failing-job:
    runs-on: ubuntu-latest
    steps:
    - run: exit 1

  succeeding-job:
    runs-on: ubuntu-latest
    steps:
    - run: exit 0

  wait-for-success:
    needs:
    - succeeding-job
    if: always()
    runs-on: ubuntu-latest
    steps:
    - if: success()
      run: echo success
    - if: failure()
      run: echo failure
    - if: cancelled()
      run: echo cancelled
    - run: echo 'results=${{ fromJSON(needs.*.result) }}'
    - run: exit 0

  wait-for-failure:
    needs:
    - failing-job
    if: always()
    runs-on: ubuntu-latest
    steps:
    - if: failure()
      run: echo failure
    - if: success()
      run: echo success
    - if: failure()
      run: echo failure
    - run: echo 'results=${{ fromJSON(needs.*.result) }}'
    - run: exit 0

  wait-for-both:
    needs:
    - failing-job
    - succeeding-job
    if: always()
    runs-on: ubuntu-latest
    steps:
    - if: failure()
      run: echo failure
    - if: success()
      run: echo success
    - if: cancelled()
      run: echo cancelled
    - run: echo 'results=${{ fromJSON(needs.*.result) }}'
    - run: echo "contains=${{ contains(needs.*.result, 'fail') }}"
    - run: exit ${{ needs.*.result }}
...
